---
title: "Inference for Numerical Data"
subtitle: "IS381 - Statistics and Probability with R"
author: Jason Bryer, Ph.D.
date: "November 10, 2025"
output:
  xaringan::moon_reader:
    css: ["assets/mtheme_max.css", "assets/fonts_mtheme_max.css"]
    lib_dir: libs
    seal: false
    nature:
      highlightStyle: solarized-light
      highlightLanguage: R
      highlightLines: true
      countIncrementalSlides: false
      ratio: "16:9"
      navigation:
        scroll: false
    includes:
      in_header: [assets/header.html]
      after_body: [assets/insert-logo.html]
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
# Cartoons from https://github.com/allisonhorst/stats-illustrations
# dplyr based upon https://allisonhorst.shinyapps.io/dplyr-learnr/#section-welcome

source('../config.R')
options(width = 120)
```

class: center, middle, inverse, title-slide

# `r metadata$title`
## `r metadata$subtitle`
### `r metadata$author`
### `r metadata$date`


---
# One Minute Paper Results

```{r, echo=FALSE, cache=FALSE}
library(googlesheets4)
omp <- read_sheet(one_minute_paper_results)
omp <- omp %>% dplyr::filter(Topic == 'Inference for Categorical Data (Chapter 6)')
```

.pull-left[
**What was the most important thing you learned during this class?**
```{r, echo=FALSE, fig.height=9}
ompWordCloud(omp$`What was the most important thing you learned during this class?`)
```
]
.pull-right[
**What important question remains unanswered for you?**
```{r, echo=FALSE, fig.height=9}
ompWordCloud(omp$`What important question remains unanswered for you?`)
```
]


---
# High School & Beyond Survey  

```{r, include=FALSE}
data(hsb2, package = 'openintro')

```

`r nrow(hsb2)` randomly selected students completed the reading and writing test of the High School and Beyond survey. The results appear to the right. Does there appear to be a difference?

.pull-left[
```{r, fig.width=5, fig.height=3.7, eval=TRUE}
data(hsb2, package = 'openintro') # in openintro package
hsb2.melt <- melt(hsb2[,c('id','read', 'write')], id='id')
ggplot(hsb2.melt, aes(x=variable, y=value)) + 	geom_boxplot() + 
	geom_point(alpha=0.2, color='blue') + xlab('Test') + ylab('Score')
```
]
.pull-right[
```{r, fig.width=5, fig.height=3.7, eval=TRUE}
ggplot(hsb2.melt, aes(x=variable, y=value)) +
	ggdist::stat_halfeye() +
	geom_point(color='blue', position = position_nudge(x = -.05), pch = '-', size = 5) + 
	xlab('Test') + ylab('Score')

```
]


---
# High School & Beyond Survey  

```{r}
head(hsb2)
```

Are the reading and writing scores of each student independent of each other?


---
# Analyzing Paired Data  

.pull-left[
* When two sets of observations are not independent, they are said to be paired.
* To analyze these type of data, we often look at the difference.

```{r, fig.width=6, fig.height=4}
hsb2$diff <- hsb2$read - hsb2$write
head(hsb2$diff)
```

```{r, eval=FALSE, fig.height=6}
ggplot(hsb2, aes(x = diff)) + 
	geom_histogram(aes(y = ..density..), bins = 15, color = 1, fill = 'white') + 
	geom_density(size = 2)
```
]
.pull-right[
```{r, echo=FALSE, fig.height=8}
ggplot(hsb2, aes(x = diff)) + 
	geom_histogram(aes(y = ..density..), bins = 15, color = 1, fill = 'white') + 
	geom_density(size = 2)
```
]

---
# Setting the Hypothesis

What are the hypothesis for testing if there is a difference between the average reading and writing scores?

$H_0$: There is no difference between the average reading and writing scores.

$$\mu_{diff} = 0$$

$H_A$: There is a difference between the average reading and writing score.

$$\mu_{diff} \ne 0$$

---
class: font120
# Nothing new here...

* The analysis is no different that what we have done before.

* We have data from one sample: differences.

* We are testing to see if the average difference is different that 0.


---
# Calculating the test-statistic and the p-value 

The observed average difference between the two scores is `r mean(hsb2$diff)` points and the standard deviation of the difference is `r round(sd(hsb2$diff), digits = 3)` points. Do these data provide convincing evidence of a difference between the average scores on the two exams (use $\alpha = 0.05$)?

```{r, fig.height = 6, echo=FALSE}
meanDiff <- mean(hsb2$diff)
sdDiff <- sd(hsb2$diff)
normal_plot(mean=0, cv = c(-1 * abs(meanDiff), abs(meanDiff)), tails = 'two.sided')
```


---
# Calculating the test-statistic and the p-value 

$$Z = \frac{-0.545 - 0}{ \frac{8.887}{\sqrt{200}} } = \frac{-0.545}{0.628} = -0.87$$
$$p-value = 0.1949 \times 2 = 0.3898$$

Since p-value > 0.05, we **fail to reject the null hypothesis**. That is, the data do not provide evidence that there is a statistically significant difference between the average reading and writing scores.

```{r}
2 * pnorm(mean(hsb2$diff), mean=0, sd=sd(hsb2$diff)/sqrt(nrow(hsb2)))
```

---
# Evaluating the null hypothesis

## Interpretation of the p-value

The probability of obtaining a random sample of 200 students where the average difference between the reading and writing scores is at least 0.545 (in either direction), if in fact the true average difference between the score is 0, is 38%.

--
## Calculating 95% Confidence Interval

$$-0.545\pm 1.96\frac { 8.887 }{ \sqrt { 200 }  } =-0.545\pm 1.96\times 0.628=(-1.775, 0.685)$$

Note that the confidence interval spans zero!

---
# Visualizing Dependent Sample Tests

```{r, results='hide', fig.height = 6.5}
# remotes::install_github('briandk/granovaGG')
library(granovaGG)
granovagg.ds(as.data.frame(hsb2[,c('read', 'write')]))
```


---
# SAT Scores by Sex

```{r}
data(sat, package = 'DATA606')
head(sat)
```

```{r, echo=FALSE, results='hide', warning=FALSE}
sat$Math.SAT <- as.integer(sat$Math.SAT)
sat <- sat[complete.cases(sat),]
```

Is there a difference in math scores between males and females?

---
# SAT Scores by Sex 

.pull-left[
```{r}
tab <- describeBy(sat$Math.SAT, 
		   group=sat$Sex, 
		   mat=TRUE, skew=FALSE)
tab[,c(2,4:7)]
```
]

.pull-right[
```{r, fig.height=7}
ggplot(sat, aes(x=Sex, y=Math.SAT)) + 
	geom_boxplot() +
	geom_point(data = tab, aes(x=group1, y=mean), 
			   color='blue', size=4)
```
]

---
# Distributions  


```{r}
ggplot(sat, aes(x=Math.SAT, color = Sex)) + geom_density()
```

---
class: font120
# 95% Confidence Interval

We wish to calculate a 95% confidence interval for the average difference between SAT scores for males and females.

Assumptions:

1. Independence within groups.

2. Independence between groups.

3. Sample size/skew

---
# Confidence Interval for Difference Between Two Means

* All confidence intervals have the same form: point estimate Â± ME
* And all ME = critical value * SE of point estimate
* In this case the point estimate is $\bar{x}_1 - \bar{x}_2$
Since the sample sizes are large enough, the critical value is z*
So the only new concept is the standard error of the difference between two means...

.pull-left[
Standard error for difference in SAT scores

$$SE_{ (\bar { x } _{ M }-\bar { x } _{ F }) }=\sqrt { \frac { { s }_{ M }^{ 2 } }{ { n }_{ M } } + \frac { { s }_{ F }^{ 2 } }{ { n }_{ F } }  }$$


$$SE_{ (\bar { x } _{ M }-\bar { x } _{ F }) } = \sqrt { \frac { 90.4 }{ 80 } +\frac { 103.7 }{ 82 }  } =1.55$$
]

.pull-right[
Calculate the 95% confidence interval:

$$(\bar{x}_{M} - \bar{x}_{F}) \pm 1.96 SE_{ (\bar { x } _{ M }-\bar { x } _{ F }) }$$
$$(626.9 - 597.7) \pm 1.96 \times 1.55$$
$$29.2 \pm 3.038 = (26.162, 32.238)$$

]

---
# Visualizing independent sample tests

```{r, echo = FALSE}
tab <- describeBy(sat$Math.SAT, group = sat$Sex, mat = TRUE)
names(tab)[2] <- 'Sex'
p_male <- ggplot(sat[sat$Sex == 'M',], aes(x = Math.SAT)) +
	geom_density(color = 'blue') +
	geom_vline(xintercept = tab[tab$Sex == 'M',]$mean, color = 'blue') +
	stat_function(geom = 'area',
				  fun = dnorm, 
				  args = list(mean = tab[tab$Sex == 'M',]$mean, 
				  			sd = tab[tab$Sex == 'M',]$se),
				  xlim = c(tab[tab$Sex == 'M',]$mean - tab[tab$Sex == 'M',]$se,
				  		   tab[tab$Sex == 'M',]$mean + tab[tab$Sex == 'M',]$se),
				  fill = 'blue', alpha = 0.5) +
	geom_function(fun = dnorm, 
				  args = list(mean = tab[tab$Sex == 'M',]$mean, 
				  			sd = tab[tab$Sex == 'M',]$se), 
				  color = 'blue') +
	ggtitle('Male') +
	xlim(c(400, 800))
p_female <- ggplot(sat[sat$Sex == 'F',], aes(x = Math.SAT)) +
	geom_density(color = 'purple') +
	geom_vline(xintercept = tab[tab$Sex == 'F',]$mean, color = 'purple') +
	stat_function(geom = 'area',
				  fun = dnorm, 
				  args = list(mean = tab[tab$Sex == 'F',]$mean, 
				  			sd = tab[tab$Sex == 'F',]$se),
				  xlim = c(tab[tab$Sex == 'F',]$mean - tab[tab$Sex == 'M',]$se,
				  		   tab[tab$Sex == 'F',]$mean + tab[tab$Sex == 'M',]$se),
				  fill = 'purple', alpha = 0.5) +
	geom_function(fun = dnorm, 
				  args = list(mean = tab[tab$Sex == 'F',]$mean, 
				  			sd = tab[tab$Sex == 'F',]$se), 
				  color = 'purple') +
	ggtitle('Female') +
	xlim(c(400, 800))
cowplot::plot_grid(p_male, p_female, ncol = 1)
```

---
# What about smaller sample sizes?

What if you want to compare the quality of one batch of Guinness beer to the next?

--

.pull-left[
* Sample sizes necessarily need to be small.
* The CLT states that the sampling distribution approximates normal as n -> Infinity
* Need an alternative to the normal distribution.
* The *t* distribution was developed by William Gosset (under the pseudonym *student*) to estimate means when the sample size is small.

Confidence interval is estimated using

$$\overline { x } \pm { t }_{ df }^{ * }SE$$

Where *df* is the degrees of freedom (*df* = *n* -1)
]

.pull-right[.center[
![](images/William_Sealy_Gosset.jpg)
]]

---
# *t*-Distributions 

```{r, echo=FALSE}
x <- seq(-4, 4, length=100)
hx <- dnorm(x)

degf <- c(1, 3, 8, 30)
colors <- c("red", "blue", "darkgreen", "gold", "black")
labels <- c("df=1", "df=3", "df=8", "df=30", "normal")

plot(x, hx, type="l", lty=2, xlab="x value",
  ylab="Density", main="Comparison of t Distributions")

for (i in 1:4){
  lines(x, dt(x,degf[i]), lwd=2, col=colors[i])
}

legend("topright", inset=.05, title="Distributions", labels, lwd=2, lty=c(1, 1, 1, 1, 2), col=colors)
```

---
# *t*-test in R 

The `pt` and `qt` will give you the *p*-value and critical value from the *t*-distribution, respectively.

.pull-left[

Critical value for p = 0.05, degrees of freedom = 10

```{r}
qt(0.025, df = 10)
```

p-value for a critical value of 2, degrees of freedom = 10

```{r}
pt(2, df=10)
```

]
.pull-right[

The `t.test` function will calculate a null hyphothesis test using the *t*-distribution.

```{r}
t.test(Math.SAT ~ Sex, data = sat)
```
]

---
class: left, font140
# One Minute Paper

.pull-left[
1. What was the most important thing you learned during this class?
2. What important question remains unanswered for you?
]
.pull-right[
```{r, echo=FALSE, fig.width=5, fig.height=5}
qrcode::qr_code(one_minute_paper) |> plot(col = c('#FAFAFA', 'black'))
```
]

`r one_minute_paper`
